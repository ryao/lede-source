--- a/init/main.c
+++ b/init/main.c
@@ -355,6 +355,54 @@ static inline void setup_nr_cpu_ids(void
 static inline void smp_prepare_cpus(unsigned int maxcpus) { }
 #endif

+#ifdef CONFIG_MANGLE_BOOTARGS
+static void __init mangle_bootargs(char *command_line)
+{
+	char *rootdev;
+	char *rootfs;
+	char *end, *num;
+	int i;
+
+	rootdev = strstr(command_line, "root=/dev/mtdblock");
+
+	if (rootdev)
+		strncpy(rootdev, "mangled_rootblock=", 18);
+	
+	else { //find partition number in cases with short format (root=/dev/mtdXX || yy:XX)
+		rootdev = strstr(command_line, "root=");
+
+		if (rootdev) {
+			end = strchr(rootdev, ' ');
+			end = end ? (end-1) : (strchr(rootdev, 0)-1);
+			num = end;
+			for (i=0; num >= rootdev && *num >= '0' && *num <= '9' ; num--, i++);
+			num++;
+
+			if (i>0) {
+				strncpy(rootdev, "mglr=", 5);
+				rootdev += 5;
+				memcpy(rootdev, num, i);
+				num += i;
+				while (num < end) {
+					*num = ' ';
+					num++;
+				}
+			}
+		}
+	}
+
+	rootfs = strstr(command_line, "rootfstype");
+
+	if (rootfs)
+		strncpy(rootfs, "mangled_fs", 10);
+
+}
+#else
+static void __init mangle_bootargs(char *command_line)
+{
+}
+#endif
+
 /*
  * We need to store the untouched command line for future reference.
  * We also need to store the touched command line since the parameter
@@ -527,6 +575,7 @@ asmlinkage __visible void __init start_k
 	pr_notice("%s", linux_banner);
 	setup_arch(&command_line);
 	mm_init_cpumask(&init_mm);
+	mangle_bootargs(command_line);
 	setup_command_line(command_line);
 	setup_nr_cpu_ids();
 	setup_per_cpu_areas();
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -1638,6 +1638,15 @@ config EMBEDDED
 	  an embedded system so certain expert options are available
 	  for configuration.
 
+config MANGLE_BOOTARGS
+	bool "Rename offending bootargs"
+	depends on EXPERT
+	help
+	  Sometimes the bootloader passed bogus root= and rootfstype=
+	  parameters to the kernel, and while you want to ignore them,
+	  you need to know the values f.e. to support dual firmware
+	  layouts on the flash.
+
 config HAVE_PERF_EVENTS
 	bool
 	help
